<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Healthcare Portal - IoT & AI Diagnosis</title>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.4.0/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-in { animation: fadeIn 0.6s ease-out; }
    .hover-scale { transition: transform 0.3s ease; }
    .hover-scale:hover { transform: scale(1.03); }
    .hero-bg { background: linear-gradient(to right, rgba(34, 197, 94, 0.1), rgba(59, 130, 246, 0.1)), url('https://images.unsplash.com/photo-1576091160399-1123a9a7b9c3?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=400&q=80'); }
    .card { display: flex; align-items: center; gap: 1rem; }
    .btn-disabled { background-color: #4bcfc5; cursor: not-allowed; }
  </style>
</head>
<body class="bg-gray-100">
  <!-- Hero Section -->
  <div class="hero-bg bg-cover bg-center h-64 flex items-center justify-center">
    <div class="text-center animate-fade-in">
      <h1 class="text-4xl md:text-5xl font-extrabold text-teal-800">Smart Healthcare Portal</h1>
      <p class="text-lg text-gray-700 mt-2">Empowering Health with IoT & AI Diagnostics</p>
    </div>
  </div>

  <!-- Error Message -->
  <div id="error" class="hidden bg-red-100 text-red-700 p-4 rounded-xl max-w-3xl mx-auto mt-6 animate-fade-in"></div>

  <!-- Patient Vitals -->
  <div class="max-w-6xl mx-auto mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
    <div class="bg-white p-6 rounded-xl shadow-lg hover-scale animate-fade-in card">
      <img src="./asset/images/tp227-06.jpg" alt="Heart icon" class="w-10 h-10">
      <div>
        <h3 class="text-lg font-semibold text-teal-700">Heart Rate</h3>
        <p id="heartRate" class="text-2xl font-bold text-green-600">0 bpm</p>
        <p id="heartRateStatus" class="text-sm text-gray-500">Normal</p>
      </div>
    </div>
    <div class="bg-white p-6 rounded-xl shadow-lg hover-scale animate-fade-in card">
      <img src="./asset/images/heart-shape-stethoscope-medical-subjects.jpg" alt="Blood Pressure icon" class="w-10 h-10">
      <div>
        <h3 class="text-lg font-semibold text-teal-700">Blood Pressure</h3>
        <p id="bloodPressure" class="text-2xl font-bold text-green-600">0/0 mmHg</p>
        <p id="bloodPressureStatus" class="text-sm text-gray-500">Normal</p>
      </div>
    </div>
    <div class="bg-white p-6 rounded-xl shadow-lg hover-scale animate-fade-in card">
      <img src="./asset/images/v871-aew-29.jpg" alt="Temperature icon" class="w-10 h-10">
      <div>
        <h3 class="text-lg font-semibold text-teal-700">Temperature</h3>
        <p id="temperature" class="text-2xl font-bold text-green-600">0 °C</p>
        <p id="temperatureStatus" class="text-sm text-gray-500">Normal</p>
      </div>
    </div>
  </div>

  <!-- Real-Time Vitals Chart -->
  <div class="max-w-6xl mx-auto mt-8 bg-white p-6 rounded-xl shadow-lg animate-fade-in">
    <h2 class="text-xl font-semibold text-teal-700 mb-4">Real-Time Vitals Trend</h2>
    <canvas id="vitalsChart" class="w-full h-64"></canvas>
  </div>

  <!-- AI Diagnosis -->
  <div class="max-w-6xl mx-auto mt-8 bg-white p-6 rounded-xl shadow-lg animate-fade-in flex items-center space-x-4">
    <img src="./asset/images/top-view-stethoscope.jpg" alt="AI icon" class="w-10 h-10">
    <div>
      <h2 class="text-xl font-semibold text-teal-700">AI Diagnosis</h2>
      <p id="diagnosis" class="text-lg text-gray-600">No diagnosis available</p>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="max-w-6xl mx-auto mt-8 flex justify-center space-x-6">
    <button id="fetchBtn" class="px-8 py-3 rounded-xl text-white font-semibold bg-teal-600 hover:bg-teal-700 transition-colors shadow-md">Fetch IoT Data</button>
    <button id="ehrBtn" class="px-8 py-3 rounded-xl text-white font-semibold bg-green-600 hover:bg-green-700 transition-colors shadow-md">Save to EHR</button>
  </div>

  <!-- Footer -->
  <footer class="text-center text-gray-600 mt-12 py-6 bg-teal-50">
    <!-- <p>Powered by xAI | Compliant with HIPAA & FHIR Standards</p> -->
    <!-- <img src="" alt="xAI Logo" class="mx-auto mt-2"> -->
  </footer>

  <script>
    // State management
    let patientData = {
      heartRate: 0,
      bloodPressure: { systolic: 0, diastolic: 0 },
      temperature: 0,
      diagnosis: null,
      status: {},
      history: { labels: [], heartRate: [] }
    };
    let chartInstance = null;

    // DOM elements
    const errorDiv = document.getElementById('error');
    const heartRateEl = document.getElementById('heartRate');
    const bloodPressureEl = document.getElementById('bloodPressure');
    const temperatureEl = document.getElementById('temperature');
    const heartRateStatusEl = document.getElementById('heartRateStatus');
    const bloodPressureStatusEl = document.getElementById('bloodPressureStatus');
    const temperatureStatusEl = document.getElementById('temperatureStatus');
    const diagnosisEl = document.getElementById('diagnosis');
    const fetchBtn = document.getElementById('fetchBtn');
    const ehrBtn = document.getElementById('ehrBtn');

    // Initialize Chart
    function initChart() {
      const ctx = document.getElementById('vitalsChart').getContext('2d');
      if (chartInstance) chartInstance.destroy();
      chartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: patientData.history.labels,
          datasets: [{
            label: 'Heart Rate (bpm)',
            data: patientData.history.heartRate,
            borderColor: 'rgba(34, 197, 94, 0.8)',
            backgroundColor: 'rgba(34, 197, 94, 0.2)',
            fill: true,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true, title: { display: true, text: 'Value' } },
            x: { title: { display: true, text: 'Time' } }
          },
          plugins: { legend: { display: true, position: 'top' } }
        }
      });
    }

    // Fetch IoT Data
    async function fetchIoTData() {
      fetchBtn.disabled = true;
      fetchBtn.classList.add('btn-disabled');
      fetchBtn.textContent = 'Fetching...';
      errorDiv.classList.add('hidden');

      try {
        const response = await axios.get('https://api.mocki.io/v2/iot-health-data', {
          params: { patientId: '12345' },
          timeout: 5000
        });
        const { heartRate, bloodPressure, temperature } = response.data;
        patientData = {
          ...patientData,
          heartRate,
          bloodPressure,
          temperature,
          history: {
            labels: [...patientData.history.labels, new Date().toLocaleTimeString()],
            heartRate: [...patientData.history.heartRate, heartRate]
          }
        };
        diagnosePatient();
        updateUI();
      } catch (error) {
        errorDiv.classList.remove('hidden');
        errorDiv.textContent = 'Failed to fetch IoT data. Please try again.';
        console.error('IoT fetch error:', error);
      } finally {
        fetchBtn.disabled = false;
        fetchBtn.classList.remove('btn-disabled');
        fetchBtn.textContent = 'Fetch IoT Data';
      }
    }

    // AI Diagnosis Logic
    function diagnosePatient() {
      let diagnosis = 'Normal';
      patientData.status = {};
      if (patientData.heartRate > 100 || patientData.heartRate < 60) {
        diagnosis = 'Abnormal heart rate detected';
        patientData.status.heartRate = 'critical';
      }
      if (patientData.bloodPressure.systolic > 140 || patientData.bloodPressure.diastolic > 90) {
        diagnosis = 'Hypertension detected';
        patientData.status.bloodPressure = 'critical';
      }
      if (patientData.temperature > 38) {
        diagnosis = 'Fever detected';
        patientData.status.temperature = 'critical';
      }
      patientData.diagnosis = diagnosis;
    }

    // Save to EHR
    async function saveToEHR() {
      try {
        await axios.post('https://api.mocki.io/v2/ehr', patientData, {
          headers: { 'Content-Type': 'application/json' }
        });
        alert('Data successfully saved to EHR!');
      } catch (error) {
        errorDiv.classList.remove('hidden');
        errorDiv.textContent = 'Failed to save data to EHR.';
        console.error('EHR save error:', error);
      }
    }

    // Update UI
    function updateUI() {
      heartRateEl.textContent = `${patientData.heartRate} bpm`;
      heartRateEl.className = `text-2xl font-bold ${patientData.status.heartRate === 'critical' ? 'text-red-600' : 'text-green-600'}`;
      heartRateStatusEl.textContent = patientData.status.heartRate === 'critical' ? 'Critical' : 'Normal';

      bloodPressureEl.textContent = `${patientData.bloodPressure.systolic}/${patientData.bloodPressure.diastolic} mmHg`;
      bloodPressureEl.className = `text-2xl font-bold ${patientData.status.bloodPressure === 'critical' ? 'text-red-600' : 'text-green-600'}`;
      bloodPressureStatusEl.textContent = patientData.status.bloodPressure === 'critical' ? 'Critical' : 'Normal';

      temperatureEl.textContent = `${patientData.temperature} °C`;
      temperatureEl.className = `text-2xl font-bold ${patientData.status.temperature === 'critical' ? 'text-red-600' : 'text-green-600'}`;
      temperatureStatusEl.textContent = patientData.status.temperature === 'critical' ? 'Critical' : 'Normal';

      diagnosisEl.textContent = patientData.diagnosis || 'No diagnosis available';
      initChart();
    }

    // Event Listeners
    fetchBtn.addEventListener('click', fetchIoTData);
    ehrBtn.addEventListener('click', saveToEHR);

    // Initialize Chart
    initChart();
  </script>
</body>
</html>